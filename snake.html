<HTML>
<head>
<title> k </title>
</head>

<body>
<canvas id=myCanvas width=300 height=300 style="background-color: pink;"> </canvas>
<script src="Net.js"></script>
<script src="Weights.js" charset="utf-8"></script>
<script src="Block.js" charset="utf-8"></script>
<script src="Neiron.js" charset="utf-8"></script>
<script>
  var ctx = myCanvas.getContext("2d");
  var grid=[];
  for(var i=0;i<32;i++){
    grid.push([]);
    for(var i2=0;i2<32;i2++){
      grid[i].push(0);
    }
  }
  var pel={x:15,y:15};
  grid[pel.x][pel.y]=1;
  var snake=[{x:20,y:20},{x:21,y:20}];
  snake.forEach(function(a){
    grid[a.x][a.y]=-1;
  });
  var headAt=0;
  var tailAt=1;
  var net=new Net(3);
  net.addBlock(288,0,net.noSquish,net.noSquish,"input",true);//17x17-head
  net.addBlock(16,1,net.sigmoid,net.Isigmoid,"middle");
  net.addBlock(4,2,net.sigmoid,net.Isigmoid,"output");
  net.connect("input","middle");
  net.connect("middle","output");
  function update(){

    var inputs=[];
    for(var i=-8;i<8;i++){
      for(var i2=-8;i2<8;i2++){
        if(i!=0 && i2!=0){
          inputs.push(grid[(snake[headAt].x+i+17)%17][(snake[headAt].y+i2+17)%17]);
        }
      }
    }
    net.setBlock("input",inputs);
    net.forwardProp();
    var out=net.getBlockOutput("output",true);
    var bigg=0;
    for(var i=1;i<4;i++){
      if(out[i]>out[bigg]){
        bigg=i;
      }
    }
    if(bigg==0){
      snake[tailAt].x=snake[headAt].x;
      snake[tailAt].y=snake[headAt].y-1;
    }else if(bigg==1){
      snake[tailAt].x=snake[headAt].x+1;
      snake[tailAt].y=snake[headAt].y;
    }else if(bigg==2){
      snake[tailAt].x=snake[headAt].x;
      snake[tailAt].y=snake[headAt].y+1;
    }else if(bigg==3){
      snake[tailAt].x=snake[headAt].x-1;
      snake[tailAt].y=snake[headAt].y;
    }
    headAt++;
    if(headAt==snake.length)headAt=0;
    tailAt++;
    if(tailAt==snake.length)tailAt=0;
    if(snake[headAt].x==pel.x && snake[headAt].y==pel.y){
      pel.y=random(0,32);
      pel.x=random(0,32);
      snake.splice(tailAt,0,{x:snake[tailAt].x,y:snake[tailAt].y});
    }

    grid=[];
    for(var i=0;i<32;i++){
      grid.push([]);
      for(var i2=0;i2<32;i2++){
        grid[i].push(0);
      }
    }

    grid[pel.x][pel.y]=1;
    snake.forEach(function(a){
      grid[a.x][a.y]=-1;
    });
    setTimeout(update,0);
  }
  update();
  function random(min,max){
    return Math.floor(Math.random()*(max-min+1)+min);
  };
</script>

</body>
</html>
